<!DOCTYPE html>
<html lang="se">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Kalkylator för ränteöverbetalning</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 20px; }
  .container { max-width: 1200px; width: 100%; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
  h1 { font-size: 1.5em; }
  table { border-collapse: collapse; width: 70%; font-size: 14px; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: right; }
  th { background: #f1f1f1; }
  .table-wrapper { overflow-x: auto; }
  .text-left { text-align: left; }
  .bg-red { background: #ffe5e5; }
  .bg-green { background: #e5ffe5; }
  .bg-fixed { background: #e0e0ff; }
  select { padding: 5px; font-size: 14px; }
  .legend { margin-bottom: 10px; }
  .legend-item { display: inline-block; padding: 4px 8px; margin-right: 10px; border-radius: 4px; font-size: 13px; }
</style>
</head>
<body>
<div class="container">
  <h1>Beräkning av ränteöverbetalning (2023–2025)</h1>
  <div id="totals"></div>
  <label>Välj lån:</label>
  <select id="loanSelect">
    <option value="447">Lån 37673447</option>
    <option value="455">Lån 37673455</option>
  </select>
  <div class="legend">
    <span class="legend-item bg-red">Överbetalning</span>
    <span class="legend-item bg-green">Underbetalning</span>
    <span class="legend-item bg-fixed">Fast ränta</span>
  </div>
  <div id="tableContainer"></div>
</div>

<script>
  // Data för lån 37673447
  const loan447Data = [
    { date: '2025-07-28', sebAvg: 2.88, applied: 3.21, debt: 357250, paid: 956 },
    { date: '2025-06-28', sebAvg: 2.91, applied: 3.21, debt: 458225, paid: 1226 },
    { date: '2025-05-28', sebAvg: 3.04, applied: 3.21, debt: 459200, paid: 1228 },
    { date: '2025-04-28', sebAvg: 3.01, applied: 3.21, debt: 460175, paid: 1231 },
    { date: '2025-03-28', sebAvg: 3.02, applied: 3.71, debt: 461150, paid: 1426 },
    { date: '2025-02-28', sebAvg: 3.02, applied: 3.71, debt: 462125, paid: 1429 },
    { date: '2025-01-28', sebAvg: 3.25, applied: 3.71, debt: 463100, paid: 1432 },
    { date: '2024-12-28', sebAvg: 3.32, applied: 4.46, debt: 464075, paid: 1725 },
    { date: '2024-11-28', sebAvg: 3.65, applied: 4.46, debt: 465050, paid: 1728 },
    { date: '2024-10-28', sebAvg: 4.02, applied: 4.46, debt: 466025, paid: 1732 },
    { date: '2024-09-28', sebAvg: 4.11, applied: 4.46, debt: 467000, paid: 1736 },
    { date: '2024-08-28', sebAvg: 4.29, applied: 5.11, debt: 467975, paid: 1993 },
    { date: '2024-07-28', sebAvg: 4.48, applied: 5.11, debt: 468950, paid: 1997 },
    { date: '2024-06-28', sebAvg: 4.49, applied: 5.36, debt: 469925, paid: 2099 },
    { date: '2024-05-28', sebAvg: 4.54, applied: 5.36, debt: 470900, paid: 2103 },
    { date: '2024-04-28', sebAvg: 4.74, applied: 5.36, debt: 471875, paid: 2108 },
    { date: '2024-03-28', sebAvg: 4.78, applied: 5.36, debt: 472850, paid: 2112 },
    { date: '2024-02-28', sebAvg: 4.79, applied: 5.36, debt: 473825, paid: 2116 },
    { date: '2024-01-28', sebAvg: 4.83, applied: 5.36, debt: 474800, paid: 2121 },
    { date: '2023-12-28', sebAvg: 4.84, applied: 5.11, debt: 475775, paid: 2026 },
    { date: '2023-11-28', sebAvg: 4.81, applied: 5.11, debt: 476750, paid: 2030 },
    { date: '2023-10-28', sebAvg: 4.76, applied: 5.11, debt: 477725, paid: 2034 },
    { date: '2023-09-28', sebAvg: 4.81, applied: 5.11, debt: 478700, paid: 2038 }
  ];

  // Data för lån 37673455 (markera fixed från 2024-10)
  const loan455Data = [
	{ date: '2025-07-28', sebAvg: 3.45, applied: 3.45, debt: 458000, paid: 1317, fixed: true },
    { date: '2025-06-28', sebAvg: 3.45, applied: 3.45, debt: 458975, paid: 1320, fixed: true },
    { date: '2025-05-28', sebAvg: 3.45, applied: 3.45, debt: 459950, paid: 1322, fixed: true },
    { date: '2025-04-28', sebAvg: 3.45, applied: 3.45, debt: 460925, paid: 1325, fixed: true },
    { date: '2025-03-28', sebAvg: 3.45, applied: 3.45, debt: 461900, paid: 1328, fixed: true },
    { date: '2025-02-28', sebAvg: 3.45, applied: 3.45, debt: 462875, paid: 1131, fixed: true },
    { date: '2025-01-28', sebAvg: 3.45, applied: 3.45, debt: 463850, paid: 1334, fixed: true },
    { date: '2024-12-28', sebAvg: 3.45, applied: 3.45, debt: 464825, paid: 1336, fixed: true },
    { date: '2024-11-28', sebAvg: 3.45, applied: 3.45, debt: 465800, paid: 1339, fixed: true },
    { date: '2024-10-28', sebAvg: 3.45, applied: 3.45, debt: 466775, paid: 1342, fixed: true },
    { date: '2024-09-28', sebAvg: 3.45, applied: 3.45, debt: 467750, paid: 1345, fixed: true },
    { date: '2024-08-28', sebAvg: 4.29, applied: 5.11, debt: 468725, paid: 1996 },
    { date: '2024-07-28', sebAvg: 4.48, applied: 5.11, debt: 469700, paid: 2000 },
    { date: '2024-06-28', sebAvg: 4.49, applied: 5.36, debt: 470675, paid: 2102 },
    { date: '2024-05-28', sebAvg: 4.54, applied: 5.36, debt: 471650, paid: 2107 },
    { date: '2024-04-28', sebAvg: 4.74, applied: 5.36, debt: 472625, paid: 2111 },
    { date: '2024-03-28', sebAvg: 4.78, applied: 5.36, debt: 473600, paid: 2115 },
    { date: '2024-02-28', sebAvg: 4.79, applied: 5.36, debt: 474575, paid: 2120 },
    { date: '2024-01-28', sebAvg: 4.83, applied: 5.36, debt: 475500, paid: 2124 },
    { date: '2023-12-28', sebAvg: 4.84, applied: 5.11, debt: 476475, paid: 2029 },
    { date: '2023-11-28', sebAvg: 4.81, applied: 5.11, debt: 477450, paid: 2033 },
    { date: '2023-10-28', sebAvg: 4.76, applied: 5.11, debt: 478425, paid: 2038 },
    { date: '2023-09-28', sebAvg: 4.81, applied: 5.11, debt: 479400, paid: 2042 }
  ];

  function calculate(data) {
    return data.map(month => {
      const difference = month.applied - month.sebAvg;
      const monthlyOverpayment = (month.debt * difference / 100) / 12;
      const wouldHavePaid = (month.debt * month.sebAvg / 100) / 12;
      return { ...month, difference, monthlyOverpayment, wouldHavePaid };
    });
  }

  const loan447Calc = calculate(loan447Data);
  const loan455Calc = calculate(loan455Data);

  function sumOverpayment(calc) {
    return calc.reduce((sum, m) => sum + (m.fixed ? 0 : Math.max(0, m.monthlyOverpayment)), 0);
  }

  const total447 = sumOverpayment(loan447Calc);
  const total455 = sumOverpayment(loan455Calc);

	function renderTotals() {
	  document.getElementById('totals').innerHTML = `
		<p><b>Lån 37673447:</b> ${total447.toLocaleString('sv-SE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} kr</p>
		<p><b>Lån 37673455:</b> ${total455.toLocaleString('sv-SE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} kr</p>
		<p><b>TOTALT:</b> ${(total447 + total455).toLocaleString('sv-SE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} kr</p>
	  `;
	}


 function renderTable(selected) {
  const data = selected === '447' ? loan447Calc : loan455Calc;
  let html = '<div class="table-wrapper"><table><thead><tr>' +
    '<th class="text-left">Datum</th>' +
    '<th>Skuld (kr)</th>' +
    '<th>SEB genomsnitt %</th>' +
    '<th>Tillämpad %</th>' +
    '<th>Skillnad %</th>' +
    '<th>Överbetalning/mån</th>' +
    '<th>Vid genomsnitt</th>' +
    '<th>Faktiskt</th>' +
    '</tr></thead><tbody>';
  data.forEach(row => {
    if (row.fixed) {
      html += `<tr class="bg-fixed">` +
        `<td class="text-left">${row.date}</td>` +
        `<td>${row.debt.toLocaleString('sv-SE')}</td>` +
        `<td>${row.sebAvg.toFixed(2)}%</td>` +
        `<td>${row.applied.toFixed(2)}%</td>` +
        `<td>-</td>` +
        `<td>-</td>` +
        `<td>${row.wouldHavePaid ? row.wouldHavePaid.toFixed(0) + ' kr' : '-'}</td>` +
        `<td>${row.paid.toLocaleString('sv-SE')} kr</td>` +
      '</tr>';
      return;
    }
    const diffClass = row.difference > 0 ? 'bg-red' : 'bg-green';
    html += `<tr class="${diffClass}">` +
      `<td class="text-left">${row.date}</td>` +
      `<td>${row.debt.toLocaleString('sv-SE')}</td>` +
      `<td>${row.sebAvg.toFixed(2)}%</td>` +
      `<td>${row.applied.toFixed(2)}%</td>` +
      `<td>${row.difference.toFixed(2)}%</td>` +
      `<td>${row.monthlyOverpayment.toFixed(0)} kr</td>` +
      `<td>${row.wouldHavePaid.toFixed(0)} kr</td>` +
      `<td>${row.paid.toLocaleString('sv-SE')} kr</td>` +
    '</tr>';
  });
  html += '</tbody></table></div>';
  document.getElementById('tableContainer').innerHTML = html;
}

  document.getElementById('loanSelect').addEventListener('change', e => {
    renderTable(e.target.value);
  });

  renderTotals();
  renderTable('447');
</script>
</body>
</html>
